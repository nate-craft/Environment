#!/usr/bin/env sh

. ~/Env/globals.sh

if ! prog_exists rofi; then
    msg_err "Rofi is not installed!"
    exit 1
fi

if ! prog_exists bc; then
    msg_err "bc is not installed!"
    exit 1
fi

if [ -z "$1" ]; then
    INPUT=$(rofi -dmenu -theme calc)
else
    INPUT=$(rofi -dmenu -theme calc -theme-str "entry {placeholder:'   [$1: clipboard]';}")
fi

if [ -z "$INPUT" ]; then
    exit 0
fi

RESULT=$(echo "scale=3;$INPUT" | bc -l --standard 2>&1)
CHARS=$(echo "$INPUT" | wc -m)

if echo "$RESULT" | rg -q "Error" || [ "$CHARS" -lt 3 ]; then
    notify-send -r 9999 "Bad Input: '${INPUT}'"   
elif echo "$RESULT" | rg -q "error"; then
    notify-send -r 9999 "Bad Syntax: '${INPUT}'"
else
    if prog_exists wl-copy; then
        echo "$RESULT" | wl-copy 
    else
        msg_err --broadcast "wl-copy is not installed - clipboard not enabled!"
    fi

    ~/Env/scripts/mathprompt "$RESULT"
fi

